{"version":3,"file":"events.js","sources":["../src/events.js"],"sourcesContent":["var eventCache = []\nwindow.eventCache = eventCache\n\nexport function defineEvents(options) {\n  if (Array.isArray(options)) {\n    options.forEach(function(event) {\n      eventCache.push(event)\n    })\n  } else {\n    eventCache.push({\n      event: options.event,\n      element: options.element,\n      targetEl: options.targetEl,\n      callback: options.callback\n    })\n  }\n}\n\nexport function bindEvents(model, actions) {\n\n  // Event delegator:\n  function delegate(element, event, targetEl, callback, position) {\n    var delegateEl\n    if (!element) element = 'body'\n    if (typeof element === 'string') {\n      delegateEl = document.querySelector(element)\n    } else if (element.nodeName) {\n      delegateEl = element\n    }\n    var eventListener = function(e) {\n      var target = e.target\n      var elements = Array.prototype.slice.apply(delegateEl.querySelectorAll(targetEl))\n      do {\n        var len = elements.length\n        for (var i = 0; i < len; i++) {\n          if (target === elements[i]) {\n            callback.call(elements[i], e, model, actions)\n            break\n          }\n        }\n      } while (target = target.parentNode)\n    }\n    eventCache[position].delegatedCallback = callback\n    /**\n     * Since eventListener wraps the provided callback for event delegation, make it the callback in eventCache to enable unbinding.\n     */\n    eventCache[position].callback = eventListener\n    // And then bind eventListener as the callback:\n    delegateEl.addEventListener(event, eventListener)\n  }\n\n  eventCache.forEach(function(evt, idx) {\n    var el\n    if (typeof evt.element === 'string') {\n      el = document.querySelector(evt.element)\n    } else {\n      el = document.querySelector('body')\n    }\n    if (evt.targetEl) {\n      delegate(evt.element, evt.event, evt.targetEl, evt.callback, idx)\n    } else {\n      var callback = function(e) {\n        evt.callback.call(el, e, model, actions)\n      }\n      el.addEventListener(evt.event, evt.callback)\n    }\n  })\n}\n\nexport function unbindEvent(element, event, callback) {\n  var el\n  if (typeof element === 'string') {\n    el = document.querySelector(element)\n  } else if (element && element.nodeName) {\n    el = element\n  } else {\n    return\n  }\n  if (!event) {\n    var clen = eventCache.length\n    if (clen < 1) return\n    for (var ci = clen; ci > 0; ci--) {\n      if (eventCache[ci] && eventCache[ci].element === element) {\n        el.removeEventListener(eventCache[ci].event, eventCache[ci].callback)\n        eventCache.splice(ci, 1)\n      }\n    }\n  } else if (event && !callback) {\n    var position = -1\n    var clen = eventCache.length\n    for (var ci = 0; ci < clen; ci++) {\n      if (eventCache[ci] && eventCache[ci].element === element && eventCache[ci].event === event) {\n        try {\n          el.removeEventListener(eventCache[ci].event, eventCache[ci].callback)\n          eventCache.splice(parseInt(ci, 10),1)\n        } catch(err) {}\n      }\n    }\n  } else if (element && event && callback) {\n    var position = -1\n    var clen = eventCache.length\n    for (var ci = 0; ci < clen; ci++) {\n      if (eventCache[ci].element === element && eventCache[ci].event === event && eventCache[ci].delegatedCallback && eventCache[ci].delegatedCallback === callback) {\n        position = ci\n      } else if (eventCache[ci].element === element && eventCache[ci].event === event && eventCache[ci].callback === callback) {\n        position = ci\n        break\n      }\n    }\n    if (position === -1) return\n    el.removeEventListener(eventCache[position].event, eventCache[position].callback)\n    eventCache.splice(position, 1)\n  } else {\n    return\n  }\n}\n\n//////////////////////////////\n// GESTURES:\n//////////////////////////////\n/**\n * Event aliases for desktop and mobile:\n */\nlet eventStart, eventEnd, eventMove, eventCancel\n\n// Pointer events for IE11 and MSEdge:\nif (window.navigator.pointerEnabled) {\n  eventStart = 'pointerdown';\n  eventEnd = 'pointerup';\n  eventMove = 'pointermove';\n  eventCancel = 'pointercancel';\n// Pointer events for IE10 and WP8:\n} else if (window.navigator.msPointerEnabled) {\n  eventStart = 'MSPointerDown';\n  eventEnd = 'MSPointerUp';\n  eventMove = 'MSPointerMove';\n  eventCancel = 'MSPointerCancel';\n// Touch events for iOS & Android:\n} else if ('ontouchstart' in window) {\n  eventStart = 'touchstart';\n  eventEnd = 'touchend';\n  eventMove = 'touchmove';\n  eventCancel = 'touchcancel';\n// Mouse events for desktop:\n} else {\n  eventStart = 'mousedown';\n  eventEnd = 'click';\n  eventMove = 'mousemove';\n  eventCancel = 'mouseout';\n}\nexport {eventStart, eventEnd, eventMove, eventCancel}\n\n// Delegate Events:\nfunction delegateTheEvent(options) {\n  var element = options.element\n  var root = options.root || document.body\n  var type = options.type\n  var callback = options.callback\n  if (typeof root === 'string') root = document.querySelector(root)\n  var eventListener = function(e) {\n    var target = e.target\n    var elements\n    if (element.nodeType) elements = [element]\n    else elements = Array.prototype.slice.apply(root.querySelectorAll(element))\n    do {\n      var len = elements.length\n      for (var i = 0; i < len; i++) {\n        if (target === elements[i]) {\n          callback.call(elements[i], e)\n          break\n        }\n      }\n    } while (target = target.parentNode)\n  }\n  root.addEventListener(type, eventListener)\n}\n\n// Fire gesture on element:\nexport function trigger(el, event, data) {\n  if (!event) {\n    console.error('No event was provided. You do need to provide one.')\n    return\n  }\n  if (typeof el === 'string') el = document.querySelector(el)\n  if (document.createEvent) {\n    var evtObj = document.createEvent('Events')\n    evtObj.initEvent(event, true, false)\n    evtObj.data = data\n    el.dispatchEvent(evtObj)\n  }\n}\n\nvar enableGestures = function() {\n  var touch = {}\n  var touchTimeout\n  var swipeTimeout\n  var tapTimeout\n  var longTapDelay = 750\n  var singleTapDelay = 150\n  var gestureLength = 20\n  if (/android/img.test(navigator.userAgent)) singleTapDelay = 200\n  var longTapTimeout\n\n  function parentIfText(node) {\n    return 'tagName' in node ? node : node.parentNode\n  }\n\n  function swipeDirection(x1, x2, y1, y2) {\n    return Math.abs(x1 - x2) >=\n      Math.abs(y1 - y2) ? (x1 - x2 > 0 ? 'left' : 'right') : (y1 - y2 > 0 ? 'up' : 'down')\n  }\n\n  function longTap() {\n    longTapTimeout = null\n    if (touch.last) {\n      try {\n        if (touch && touch.el) {\n          trigger(touch.el, 'longtap')\n          touch = {}\n        }\n      } catch (err) {}\n    }\n  }\n\n  function cancelLongTap() {\n    if (longTapTimeout) clearTimeout(longTapTimeout)\n    longTapTimeout = null\n  }\n\n  function cancelAll() {\n    if (touchTimeout) clearTimeout(touchTimeout)\n    if (tapTimeout) clearTimeout(tapTimeout)\n    if (swipeTimeout) clearTimeout(swipeTimeout)\n    if (longTapTimeout) clearTimeout(longTapTimeout)\n    touchTimeout = tapTimeout = swipeTimeout = longTapTimeout = null\n    touch = {}\n  }\n\n  /**\n   * Execute this after DOM loads:\n   */\n  (function() {\n    var now\n    var delta\n    var body = document.body\n    var twoTouches = false\n\n    /**\n     * Capture start of event:\n     */\n    body.addEventListener(eventStart, function(e) {\n      now = Date.now()\n      delta = now - (touch.last || now)\n      if (e.originalEvent) e = e.originalEvent\n\n      if (eventStart === 'mousedown') {\n        touch.el = parentIfText(e.target)\n        if (e.target.nodeName === 'ripple') {\n          touch.el = el.target.parentNode\n        }\n        touchTimeout && clearTimeout(touchTimeout)\n        touch.x1 = e.pageX\n        touch.y1 = e.pageY\n        twoTouches = false\n\n      /**\n       * Detect two or more finger gestures:\n       */\n      } else {\n        if (e.touches.length === 1) {\n          if (!!e.target.disabled) return\n          touch.el = parentIfText(e.touches[0].target)\n          touchTimeout && clearTimeout(touchTimeout)\n          touch.x1 = e.touches[0].pageX\n          touch.y1 = e.touches[0].pageY\n          if (e.targetTouches.length === 2) {\n            twoTouches = true\n          } else {\n            twoTouches = false\n          }\n        }\n      }\n\n      if (delta > 0 && delta <= 450) {\n        touch.isDoubleTap = true\n      }\n      touch.last = now\n      longTapTimeout = setTimeout(longTap, longTapDelay)\n    })\n\n    /**\n     * Capture event move:\n     */\n    body.addEventListener(eventMove, function(e) {\n      if (e.originalEvent) e = e.originalEvent\n      cancelLongTap()\n      if (eventMove === 'mousemove') {\n        touch.x2 = e.pageX\n        touch.y2 = e.pageY\n      } else {\n        /**\n         * One finger gesture:\n         */\n        if (e.touches.length === 1) {\n          touch.x2 = e.touches[0].pageX\n          touch.y2 = e.touches[0].pageY\n          touch.move = true\n        }\n      }\n    })\n\n    /**\n     * Capture event end:\n     */\n    body.addEventListener(eventEnd, function(e) {\n\n      cancelLongTap()\n      if (!!touch.el) {\n        /**\n         * Swipe detection:\n         */\n        if ((touch.x2 && Math.abs(touch.x1 - touch.x2) > gestureLength) ||\n          (touch.y2 && Math.abs(touch.y1 - touch.y2) > gestureLength)) {\n          swipeTimeout = setTimeout(function() {\n            if (touch && touch.el) {\n              trigger(touch.el, 'swipe')\n              trigger(touch.el, 'swipe' + (swipeDirection(touch.x1, touch.x2, touch.y1, touch.y2)))\n              touch = {}\n            }\n          }, 0)\n\n        /**\n         * Normal tap:\n         */\n        } else if ('last' in touch) {\n          /**\n           * Delay by one tick so we can cancel the 'tap' event if 'scroll' fires:\n           */\n          tapTimeout = setTimeout(function() {\n            /**\n             * Trigger double tap immediately:\n             */\n            if (touch && touch.isDoubleTap) {\n              if (touch && touch.el) {\n                trigger(touch.el, 'doubletap')\n                e.preventDefault()\n                touch = {}\n              }\n\n            } else {\n              /**\n               * Trigger tap after singleTapDelay:\n               */\n              touchTimeout = setTimeout(function() {\n                touchTimeout = null\n                if (touch && touch.el && !touch.move) {\n                  trigger(touch.el, 'tap')\n                  touch = {}\n\n                } else {\n                  /**\n                   * Touch moved so cancel tap:\n                   */\n                  cancelAll()\n                }\n              }, singleTapDelay)\n            }\n          }, 0)\n        }\n\n      } else {\n        return\n      }\n    })\n    body.addEventListener('touchcancel', cancelAll)\n  })()\n}\nenableGestures()\n"],"names":["defineEvents","options","Array","isArray","forEach","event","eventCache","push","element","targetEl","callback","bindEvents","model","actions","delegate","position","delegateEl","document","querySelector","nodeName","eventListener","e","target","elements","prototype","slice","apply","querySelectorAll","len","length","i","call","parentNode","delegatedCallback","addEventListener","evt","idx","el","unbindEvent","clen","ci","removeEventListener","splice","parseInt","err","trigger","data","console","error","createEvent","evtObj","initEvent","dispatchEvent","window","navigator","pointerEnabled","eventStart","eventEnd","eventMove","eventCancel","msPointerEnabled","parentIfText","node","swipeDirection","x1","x2","y1","y2","Math","abs","longTap","longTapTimeout","touch","last","cancelLongTap","clearTimeout","cancelAll","touchTimeout","tapTimeout","swipeTimeout","singleTapDelay","test","userAgent","now","delta","body","twoTouches","Date","originalEvent","pageX","pageY","touches","disabled","targetTouches","isDoubleTap","setTimeout","move","preventDefault"],"mappings":"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"}